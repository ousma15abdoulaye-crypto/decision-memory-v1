# ADR-0001 — Plan Milestones V3.3.2, Fusion M10-UX + Registre dépôt, Discipline Agents

- Status: ACCEPTED
- Freeze: included in tag v3.3.2-freeze
- Date: 2026-02-16
- Author: Abdoulaye Ousmane (Founder & CTO)
- Constitution: V3.3.2 (canonique)
- Related:
  - docs/CONSTITUTION_DMS_V3.3.2.md
  - docs/MILESTONES_EXECUTION_PLAN_V3.3.2.md
  - docs/freeze/v3.3.2/FREEZE_MANIFEST.md

## 1. Contexte

Le DMS V3.3.2 définit:

- Une Couche A: exécution autonome (documents → extraction → normalisation → scoring → génération CBA/PV).
- Une Couche B: mémoire décisionnelle + Market Signal à 3 sources, strictement non prescriptive.
- Un dictionnaire procurement: colonne vertébrale partagée.
- 9 invariants opposables (INV-1 à INV-9) + SLA (§7).

Les milestones V3.3.1/V3.3.2 existaient déjà, mais:

- M9 “registre dépôt” et M10 “UX” se chevauchaient.
- La sécurité technique (auth, RBAC, rate limit) était partiellement implémentée mais non encapsulée dans un milestone clair.
- Le registre de dépôt, central pour la traçabilité (INV-6), était rangé côté “sécurité” alors que c’est un écran UX Couche A.

## 2. Décision

### 2.1. Fusion M9 (Registre dépôt) → M10-UX-V2

Nous décidons:

- De fusionner le registre de dépôt des offres (M9) dans le milestone M10-UX-V2.

- M10 couvre désormais:
  - Le workflow UX Couche A (Home + 5 écrans) + écrans dérivés.
  - Le registre de dépôt comme écran 2bis:
    - Table `submission_deposits`.
    - Endpoints `GET/POST /ux/workspace/deposit-registry/{case_id}`.
    - Auto-suggestion des timestamps (depuis `documents` + `extractions`) avec validation humaine, et traçabilité append-only.

- De lier explicitement ce registre à:
  - §6.1 (documents/extractions).
  - INV-6 (append-only).
  - INV-9 (fidélité au réel).
  - Objectif “zéro saisie manuelle répétitive” (§0).

### 2.2. Création d’un milestone séparé M-SECURITY-CORE

Pour éviter la confusion “M9 = sécurité + registre”, nous décidons:

- De créer un milestone M-SECURITY-CORE distinct qui couvre:
  - JWT, RBAC 5 rôles, rate limiting, validation upload, secrets, audit.
  - Tests sécurité (JWT expiration, RBAC, rate limit, magic bytes, append-only).

- De faire de M-SECURITY-CORE un prérequis pour tout GO pré-production.

### 2.3. Market Signal + Market Survey = BLOQUANT GO production client

Nous confirmons:

- Market Survey + Market Signal ne sont plus “nice to have”, mais bloquants pour un GO production client/externe:
  - M-MARKET-SURVEY-WORKFLOW + M-MARKET-SIGNAL-ENGINE + M-CONTEXT-UI-PANEL doivent être terminés et testés.
  - Un DMS en prod client sans ces modules est considéré non conforme à la Constitution V3.3.2.

### 2.4. Dictionnaire procurement non contournable

Nous gelons la règle suivante:

> Aucun module Couche A (scoring, génération, pipeline E2E) ne peut consommer des offres brutes. Toutes les offres doivent être normalisées via M-NORMALISATION-ITEMS (dictionnaire).

Conséquences:

- Tests CI obligatoires:
  - `test_no_raw_offer_in_scoring`.
  - `test_offers_must_be_normalized`.

### 2.5. Discipline agents (humains + IA)

Nous imposons les règles suivantes pour tous les agents (développeurs, reviewers, IA):

1. Source de vérité unique:
   - Les seuls documents autorisés comme référence pour la structure du système sont:
     - Constitution V3.3.2.
     - Plan Milestones V3.3.2.
     - ADRs acceptés et inclus dans le freeze (dont ADR-0001).

2. Interdiction d’inventer des milestones:
   - Un agent ne peut pas créer ou renommer des milestones en dehors du plan V3.3.2 sans:
     - un ADR séparé,
     - une validation CTO explicite.

3. Definition of Done commune:
   - Toute tâche/milestone doit être validée selon la DDO commune décrite dans `MILESTONES_EXECUTION_PLAN_V3.3.2.md`.
   - “Code écrit” sans tests/doc ≡ “non fait”.

4. CI comme arbitre:
   - CI verte, invariants, SLA → condition nécessaire.
   - Aucune PR mergée avec CI rouge, même temporairement.

5. Usage des agents IA:
   - Les agents d’écriture de code doivent:
     - Lire d’abord Constitution + Plan Milestones + ADR-0001.
     - Respecter les invariants (INV-3: Couche B non prescriptive; INV-7: ERP-agnostique).
     - Ne jamais introduire de dépendance ERP, ni de logique Couche B dans la Couche A.

## 3. Alternatives rejetées

- Laisser M9 “registre dépôt” comme milestone sécurité → confusion entre UX et sécurité.
- Laisser Market Survey en “Phase optionnelle” → contraire à la vocation du DMS.
- Laisser les agents IA improviser la structure → risque de dérive architecturelle.

## 4. Conséquences

- La roadmap devient plus claire:
  - M10 = UX Couche A complète (y compris registre dépôt).
  - M-SECURITY-CORE = posture sécurité technique.

- Les audits futurs sauront:
  - où trouver le registre dépôt,
  - où vérifier la sécurité (un seul milestone),
  - quels tests CI garantissent quoi.

## 5. Notes d’implémentation (anti-contournement)

- Emplacement ADR: `docs/adrs/ADR-0001.md`
- Le registre des milestones est authoritative: `docs/MILESTONES_EXECUTION_PLAN_V3.3.2.md`
- Aucun renommage de milestone sans ADR + validation CTO.
- Les noms des checks CI (coverage/invariants/sla) font partie du contrat de qualité.

## 6. Décision finale

- Cet ADR est ACCEPTÉ et inclus dans le freeze V3.3.2.
- Toute modification de la structure des milestones ou des responsabilités de M10-UX-V2 et M-SECURITY-CORE doit passer par:
  - un nouvel ADR (ADR-000X),
  - une validation CTO explicite.

_Fin ADR-0001._
